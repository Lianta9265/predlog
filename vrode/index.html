<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–∏–¥–µ–æ ‚Äî –ü–ª–∞—Ç–æ–Ω</title>
  <style>
    :root{
      --bg1:#070b1a;
      --bg2:#141a33;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.18);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --good: #3df08b;
      --bad: #ff4d6d;
      --warn: #ffd166;
      --accent: #66d9ff;
      --accent2:#b988ff;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(102,217,255,.32), transparent 55%),
        radial-gradient(900px 600px at 90% 10%, rgba(185,136,255,.30), transparent 55%),
        radial-gradient(900px 700px at 60% 100%, rgba(61,240,139,.22), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    .stars::before,
    .stars::after{
      content:"";
      position:absolute;
      inset:-40px;
      background-image:
        radial-gradient(1px 1px at 20px 30px, rgba(255,255,255,.45), transparent 55%),
        radial-gradient(1px 1px at 140px 90px, rgba(255,255,255,.35), transparent 55%),
        radial-gradient(1px 1px at 280px 160px, rgba(255,255,255,.30), transparent 55%),
        radial-gradient(1px 1px at 420px 40px, rgba(255,255,255,.28), transparent 55%),
        radial-gradient(1px 1px at 560px 120px, rgba(255,255,255,.26), transparent 55%),
        radial-gradient(1px 1px at 700px 200px, rgba(255,255,255,.32), transparent 55%),
        radial-gradient(1px 1px at 840px 80px, rgba(255,255,255,.22), transparent 55%),
        radial-gradient(1px 1px at 980px 170px, rgba(255,255,255,.24), transparent 55%);
      opacity:.55;
      pointer-events:none;
      filter: blur(.2px);
      transform: translateZ(0);
    }
    .stars::after{ opacity:.35; transform: scale(1.1); }

    .app{
      position:relative;
      height:100%;
      display:flex;
      flex-direction:column;
      gap:14px;
      padding:16px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:baseline;
      gap:10px;
      user-select:none;
    }
    .brand .title{
      font-weight:800;
      letter-spacing:.2px;
      font-size:16px;
      opacity:.95;
    }
    .brand .badge{
      font-size:12px;
      color: var(--muted);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      padding:6px 10px;
      border-radius:999px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
    }

    button{
      appearance:none;
      border:none;
      cursor:pointer;
      color: var(--text);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      padding:10px 14px;
      border-radius: 14px;
      font-weight:700;
      letter-spacing:.3px;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      transition: transform .12s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.22); }
    button:active{ transform: translateY(0px) scale(.99); }
    button[disabled]{ opacity:.45; cursor:not-allowed; transform:none; }

    .btn-primary{
      background: linear-gradient(135deg, rgba(102,217,255,.25), rgba(185,136,255,.20));
      border-color: rgba(102,217,255,.28);
    }
    .btn-primary:hover{ background: linear-gradient(135deg, rgba(102,217,255,.33), rgba(185,136,255,.26)); }

    .btn-warn{
      background: rgba(255,209,102,.16);
      border-color: rgba(255, 209, 102, 0.695);
    }

    .pulse{
      animation: pulse 1.05s ease-in-out infinite;
      box-shadow: 0 0 0 0 rgba(255,209,102,.35), 0 12px 28px rgba(0,0,0,.25);
    }
    @keyframes pulse{
      0%{ box-shadow: 0 0 0 0 rgba(255,209,102,.38), 0 12px 28px rgba(0,0,0,.25); }
      70%{ box-shadow: 0 0 0 10px rgba(255,209,102,0), 0 12px 28px rgba(0,0,0,.25); }
      100%{ box-shadow: 0 0 0 0 rgba(255,209,102,0), 0 12px 28px rgba(0,0,0,.25); }
    }

    .stage{
      flex:1;
      min-height:0;
      display:grid;
      grid-template-columns: 1.35fr .9fr;
      gap:14px;
    }

    .panel{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
      min-height:0;
    }

    .screen{
      display:flex;
      align-items:center;
      justify-content:center;
      height:100%;
      min-height:0;
      padding:14px;
    }

    .media-wrap{
      width:100%;
      height:100%;
      min-height:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    video, img{
      width:100%;
      height:100%;
      object-fit: contain;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
    }

    .right{
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .card{
      padding:14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }

    .card h2{
      margin:0 0 6px 0;
      font-size:16px;
      letter-spacing:.2px;
    }

    .card p{ margin:0; color:var(--muted); font-size:13px; line-height:1.35; }

    .task{
      padding:14px;
      overflow:auto;
      min-height:0;
    }

    .task-title{
      font-weight:800;
      margin:0 0 10px 0;
      font-size:14px;
    }

    .q{
      margin:0 0 10px 0;
      font-size:14px;
      line-height:1.35;
    }

    .options{ display:flex; flex-direction:column; gap:10px; margin: 10px 0 12px 0; }

    .opt{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      transition: background .12s ease, border-color .12s ease;
    }
    .opt:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.18); }

    .opt input{ margin-top:2px; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }

    .mini{
      font-size:12px;
      color: var(--muted);
      margin-top:8px;
    }

    .msg{
      margin-top:12px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      font-weight:700;
      display:none;
    }

    .msg.good{ display:block; border-color: rgba(61,240,139,.35); background: rgba(61,240,139,.10); }
    .msg.bad{ display:block; border-color: rgba(255,77,109,.38); background: rgba(255,77,109,.10); }

    .hint{
      margin-top:12px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(102,217,255,.10);
      border: 1px solid rgba(102,217,255,.25);
      color: rgba(255,255,255,.92);
      font-size: 13px;
      display:none;
    }

    .footer-note{
      margin-top:auto;
      padding:10px 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.60);
      font-size: 12px;
    }

    .hidden{ display:none !important; }

    /* –í—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ */
    select.inline-select{
      appearance:none;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      color: var(--text);
      padding:8px 10px;
      border-radius: 12px;
      font-weight:800;
      letter-spacing:.2px;
      outline:none;
      box-shadow: 0 10px 25px rgba(0,0,0,.18);
      margin: 0 6px;
    }
    select.inline-select:focus{
      border-color: rgba(102, 217, 255, 0.64);
      box-shadow: 0 0 0 4px rgba(102,217,255,.10), 0 10px 25px rgba(0,0,0,.18);
    }
    option{ color:#111; }

    @media (max-width: 980px){
      .stage{ grid-template-columns: 1fr; }
      .right{ order:-1; }
    }
  

    /* =========================
       COSMIC UPGRADE (safe)
       Adds: nebula haze, soft grain, holographic borders, glow feedback.
       Does NOT change layout/IDs/JS logic.
       ========================= */

    /* Background layers: nebula + subtle grain + orbit rings */
    body::before{
      content:"";
      position: fixed;
      inset: -20px;
      background:
        radial-gradient(1100px 700px at 15% 5%, rgba(102, 217, 255, 0.712), transparent 60%),
        radial-gradient(900px 650px at 85% 15%, rgba(231, 136, 255, 0.618), transparent 62%),
        radial-gradient(1000px 750px at 55% 105%, rgba(61, 240, 139, 0.638), transparent 60%),
        radial-gradient(700px 500px at 40% 55%, rgba(255, 209, 102, 0.719), transparent 55%);
      pointer-events:none;
      z-index: -2;
      filter: saturate(1.1);
    }

    /* Soft grain (CSS-only, tiny and subtle) */
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: -1;
      opacity: .10;
      background-image:
        radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,.35), transparent 55%),
        radial-gradient(1px 1px at 28% 72%, rgba(255,255,255,.25), transparent 55%),
        radial-gradient(1px 1px at 63% 36%, rgba(255,255,255,.25), transparent 55%),
        radial-gradient(1px 1px at 78% 82%, rgba(255,255,255,.22), transparent 55%),
        radial-gradient(1px 1px at 90% 44%, rgba(255,255,255,.18), transparent 55%);
      mix-blend-mode: screen;
    }

    /* Make the star layer feel more "station-like" with faint rings */
    .stars{
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events:none;
    }
    .stars::before,
    .stars::after{
      /* keep your existing stars, plus add faint orbit arcs */
      background-image:
        radial-gradient(1px 1px at 20px 30px, rgba(255,255,255,.45), transparent 55%),
        radial-gradient(1px 1px at 140px 90px, rgba(255,255,255,.35), transparent 55%),
        radial-gradient(1px 1px at 280px 160px, rgba(255,255,255,.30), transparent 55%),
        radial-gradient(1px 1px at 420px 40px, rgba(255,255,255,.28), transparent 55%),
        radial-gradient(1px 1px at 560px 120px, rgba(255,255,255,.26), transparent 55%),
        radial-gradient(1px 1px at 700px 200px, rgba(255,255,255,.32), transparent 55%),
        radial-gradient(1px 1px at 840px 80px, rgba(255,255,255,.22), transparent 55%),
        radial-gradient(1px 1px at 980px 170px, rgba(255,255,255,.24), transparent 55%),
        radial-gradient(900px 900px at 15% 85%, rgba(102,217,255,.08), transparent 55%),
        radial-gradient(800px 800px at 80% 25%, rgba(185,136,255,.08), transparent 55%);
    }

    /* Holographic panels: richer glass + subtle inner glow */
    .panel{
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow:
        inset 0 0 26px rgba(255,255,255,.07),
        0 18px 60px rgba(0,0,0,.45),
        0 0 40px rgba(102,217,255,.12);
    }
    /* Nice "edge highlight" without extra elements */
    .panel::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      pointer-events:none;
      background:
        radial-gradient(900px 200px at 20% 0%, rgba(102,217,255,.18), transparent 60%),
        radial-gradient(700px 240px at 90% 10%, rgba(185,136,255,.14), transparent 60%);
      opacity:.35;
      mix-blend-mode: screen;
    }

    /* Buttons: more neon clarity, but same sizing */
    button{
      background:
        linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.08));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow:
        0 12px 28px rgba(0,0,0,.28),
        0 0 22px rgba(102,217,255,.10);
      text-shadow: 0 1px 0 rgba(0,0,0,.25);
    }
    .btn-primary{
      background: linear-gradient(135deg, rgba(102,217,255,.32), rgba(185,136,255,.22));
      border-color: rgba(102,217,255,.38);
      box-shadow:
        0 14px 30px rgba(0,0,0,.28),
        0 0 28px rgba(102,217,255,.28);
    }
    .btn-primary:hover{
      background: linear-gradient(135deg, rgba(102,217,255,.40), rgba(185,136,255,.28));
      box-shadow:
        0 16px 34px rgba(0,0,0,.30),
        0 0 34px rgba(102,217,255,.32);
    }
    .btn-warn{
      background: linear-gradient(135deg, rgba(255,209,102,.22), rgba(255,255,255,.08));
      border-color: rgba(110, 255, 102, 0.45);
      box-shadow:
        0 14px 30px rgba(0,0,0,.28),
        0 0 26px rgba(255,209,102,.20);
    }

    /* Options look like mini glass capsules */
    .opt{
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow:
        inset 0 0 16px rgba(255,255,255,.05),
        0 10px 22px rgba(0,0,0,.20);
    }
    .opt:hover{
      border-color: rgba(255,255,255,.22);
      box-shadow:
        inset 0 0 18px rgba(255,255,255,.07),
        0 12px 26px rgba(0,0,0,.22),
        0 0 22px rgba(102,217,255,.10);
    }

    /* Task appearance micro-animation (safe) */
    .task{
      animation: taskAppear .32s ease;
    }
    @keyframes taskAppear{
      from{ opacity: 0; transform: translateY(6px) scale(.985); }
      to{ opacity: 1; transform: translateY(0) scale(1); }
    }

    /* Feedback messages: neon glow, readable */
    .msg.good{
      border-color: rgba(61,240,139,.55);
      background: linear-gradient(135deg, rgba(61,240,139,.16), rgba(102,217,255,.10));
      box-shadow:
        0 0 28px rgba(61, 240, 139, 0.497),
        inset 0 0 18px rgba(255,255,255,.08);
      animation: successPulse 1.05s ease;
    }
    @keyframes successPulse{
      0%{ box-shadow: 0 0 0 rgba(61,240,139,0), inset 0 0 18px rgba(255,255,255,.08); }
      60%{ box-shadow: 0 0 34px rgba(61,240,139,.32), inset 0 0 18px rgba(255,255,255,.10); }
      100%{ box-shadow: 0 0 28px rgba(61,240,139,.26), inset 0 0 18px rgba(255,255,255,.08); }
    }
    .msg.bad{
      border-color: rgba(255,77,109,.55);
      background: linear-gradient(135deg, rgba(255,77,109,.16), rgba(185,136,255,.10));
      box-shadow:
        0 0 30px rgba(255,77,109,.22),
        inset 0 0 18px rgba(255,255,255,.07);
    }

    /* Holographic select (Task 5): clearer and more "module-like" */
    select.inline-select{
      background: linear-gradient(135deg, rgba(102,217,255,.18), rgba(185,136,255,.14));
      border-color: rgba(255,255,255,.28);
      box-shadow:
        0 12px 26px rgba(0,0,0,.22),
        0 0 26px rgba(102,217,255,.18),
        inset 0 0 12px rgba(255,255,255,.10);
    }
    select.inline-select:hover{
      border-color: rgba(102,217,255,.42);
    }
    select.inline-select:focus{
      border-color: rgba(102,217,255,.55);
      box-shadow:
        0 0 0 4px rgba(102,217,255,.12),
        0 12px 26px rgba(0,0,0,.22),
        0 0 34px rgba(102,217,255,.26),
        inset 0 0 14px rgba(255,255,255,.12);
    }

    /* Slightly crisper heading contrast */
    .card{
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }

    /* Make media frame feel like a docking window */
    video, img{
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.08),
        0 0 30px rgba(102,217,255,.10);
    }

    /* ===== : —É–≤–µ–ª–∏—á–∏—Ç—å –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª ===== */
    #task5 .q{
      line-height: 2;          /* –≤–¥–≤–æ–µ –±–æ–ª—å—à–µ */
    }
    #task5 .q b,
    #task5 .q select{
      display: inline-block;
      margin: 8px 6px;         /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π ¬´–≤–æ–∑–¥—É—Ö¬ª */
    }
    #task5 select.inline-select{
      margin-top: 6px;
      margin-bottom: 6px;
    }


    /* ===== –¶–í–ï–¢–ù–´–ï –ö–û–°–ú–ò–ß–ï–°–ö–ò–ï –†–ê–ú–ö–ò ===== */

    /* –û–±—â–∞—è –Ω–µ–æ–Ω–æ–≤–∞—è —Ä–∞–º–∫–∞ */
    .panel{
      position: relative;
    }

    /* –°–ò–ù–Ø–Ø —Ä–∞–º–∫–∞ ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º */
    .panel::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      pointer-events:none;
      box-shadow:
        inset 0 0 0 1px rgba(102, 217, 255, 0.608),
        inset 0 0 18px rgba(222, 102, 255, 0.596),
        0 0 28px rgba(102, 217, 255, 0.485);
      mix-blend-mode: screen;
    }

    /* –ó–ï–õ–Å–ù–ê–Ø —Ä–∞–º–∫–∞ ‚Äî —É—Å–ø–µ—Ö */
    .msg.good{
      position: relative;
    }
    .msg.good::after{
      content:"";
      position:absolute;
      inset:-3px;
      border-radius: inherit;
      pointer-events:none;
      box-shadow:
        inset 0 0 0 1px rgba(61,240,139,.6),
        inset 0 0 20px rgba(61,240,139,.35),
        0 0 36px rgba(61,240,139,.45);
    }

    /* –°–ò–ù–Ø–Ø —Ä–∞–º–∫–∞ ‚Äî –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ */
    select.inline-select{
      position: relative;
    }

    /* –ó–ï–õ–Å–ù–û–ï —Å–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
    select.inline-select:focus{
      box-shadow:
        0 0 0 3px rgba(61,240,139,.18),
        0 0 28px rgba(61,240,139,.55),
        inset 0 0 14px rgba(255,255,255,.15);
    }

    /* –ú—è–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞ —Ä–∞–º–æ–∫ */
    @keyframes glowPulse{
      0%{opacity:.6}
      50%{opacity:1}
      100%{opacity:.6}
    }

    .panel::after{
      animation: glowPulse 4s ease-in-out infinite;
    }


    /* ===== –°–õ–£–ñ–ï–ë–ù–ê–Ø –ü–û–î–°–ö–ê–ó–ö–ê –ü–†–û –§–ê–ô–õ–´ (–Ω–µ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤) ===== */
    .dev-note{ display:none; }
    body.dev .dev-note{ display:block; }


    /* ===== –°–ö–†–´–¢–ò–ï –°–õ–£–ñ–ï–ë–ù–´–• –ü–û–î–°–ö–ê–ó–û–ö –î–õ–Ø –£–ß–ï–ù–ò–ö–û–í ===== */
    .mini.answer-hint,
    .answer-hint{
      display:none !important;
    }

    /* ===== –°–ö–†–´–¢–¨ –ù–£–ú–ï–†–ê –ó–ê–î–ê–ù–ò–ô (–Ω–µ–ª–∏–Ω–µ–π–Ω—ã–π –∫–≤–µ—Å—Ç) ===== */
    .task-title,
    .task-title *{
      display:none !important;
    }


    /* ===== –ü–û–õ–ù–û–ï –°–ö–†–´–¢–ò–ï –õ–Æ–ë–´–• –û–¢–í–ï–¢–û–í-–ü–û–î–°–ö–ê–ó–û–ö ===== */
    .answer-hint,
    .correct-answer,
    .right-answer,
    .mini,
    .mini *{
      display:none !important;
      visibility:hidden !important;
      height:0 !important;
      margin:0 !important;
      padding:0 !important;
    }


    /* ===== –£–í–ï–õ–ò–ß–ï–ù–ò–ï –®–†–ò–§–¢–ê x1.2 (–ë–ï–ó –õ–û–ì–ò–ö–ò) ===== */
    html{
      font-size: 120%;
    }

    /* –ß—É—Ç—å –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –Ω–µ ¬´—Ä–∞—Å–ø—É—Ö–ª–∏¬ª */
    button{
      font-size: 0.95em;
    }


    /* ===== –°–ö–†–´–¢–¨ –°–õ–£–ñ–ï–ë–ù–´–ô –°–û–í–ï–¢ –ü–†–û –°–¢–ê–†–¢ –í–ò–î–ï–û ===== */
    .start-hint,
    .hint,
    .video-hint{
      display:none !important;
    }

    /* ===== –£–í–ï–õ–ò–ß–ò–¢–¨ –®–†–ò–§–¢ –í–û–ü–†–û–°–û–í x1.3 ===== */
    .question,
    .q,
    .task-text,
    .task-description,
    .panel-right h3 + p{
      font-size: 1.3em;
      line-height: 1.6;
    }


    /* ===== TASK 6: –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç ===== */
    #task6 .q{
      line-height: 1.8;
    }
    .token{
      display:inline-block;
      padding: 2px 8px;
      margin: 1px 2px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      cursor: pointer;
      user-select:none;
      font-weight: 900;
      letter-spacing: .2px;
      transition: transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
    }
    .token:hover{ transform: translateY(-1px); border-color: rgba(102,217,255,.35); box-shadow: 0 0 18px rgba(102,217,255,.14); }
    .token.selected{
      border-color: rgba(102,217,255,.55);
      background: rgba(102,217,255,.10);
      box-shadow: 0 0 22px rgba(102,217,255,.16);
    }
    .token.selected.good{
      border-color: rgba(61,240,139,.70);
      background: rgba(61,240,139,.14);
      box-shadow: 0 0 22px rgba(61,240,139,.22);
    }
    .token.selected.bad{
      border-color: rgba(255,77,109,.70);
      background: rgba(255,77,109,.14);
      box-shadow: 0 0 22px rgba(255,77,109,.18);
    }

</style>
</head>
<body>
  <div class="stars"></div>
  <div class="app">
    <header>
      <div class="brand">
        <div class="title">–ü–ª–∞—Ç–æ–Ω –∏—â–µ—Ç –ø—Ä–µ–¥–ª–æ–≥</div>
        <div class="badge" id="statusBadge">–ì–æ—Ç–æ–≤–æ –∫ —Å—Ç–∞—Ä—Ç—É</div>
      </div>
      <div class="controls">
        <button class="btn-primary" id="btnStart">–°–¢–ê–†–¢</button>
        <button class="btn-warn" id="btnContinue" disabled>–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
      </div>
    </header>

    <main class="stage">
      <section class="panel" aria-label="–≠–∫—Ä–∞–Ω">
        <div class="screen">
          <div class="media-wrap">
            <video id="player" class="hidden" playsinline preload="metadata"></video>
            <img id="picture" class="hidden" alt="–ö–∞–¥—Ä" />
            <div id="welcome" style="max-width:720px; text-align:center; padding:26px;">
              <div style="font-weight:900; font-size:22px; letter-spacing:.2px;">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–∏–¥–µ–æ</div>
              <div style="margin-top:10px; color:var(--muted); line-height:1.45;">
                –ù–∞–∂–º–∏ <b>–°–¢–ê–†–¢</b> ‚Äî —Å–º–æ—Ç—Ä–∏, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å –ü–ª–∞—Ç–æ–Ω–æ–º. –í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è.
                <br />–ï—Å–ª–∏ –æ—à–∏–±—ë—à—å—Å—è, –ø–æ–≤—Ç–æ—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ –∏ –Ω–∞–∂–º–∏ <b>–ü–†–û–î–û–õ–ñ–ò–¢–¨</b>.
              </div>
              <div class="mini dev-note" style="margin-top:12px;">
                –§–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å —Ä—è–¥–æ–º —Å <b>index.html</b> –∏ –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫:
                <b>video.mp4</b>, <b>video1.mp4</b>, <b>video2.mp4</b>, <b>video3.mp4</b>, <b>video4.mp4</b>, <b>rule.png</b>, <b>rule2.png</b>, <b>rule3.png</b>.
              </div>
            </div>
          </div>
        </div>
      </section>

      <aside class="panel right" aria-label="–ó–∞–¥–∞–Ω–∏—è">
        <div class="card">
          <h2 id="panelTitle">–ü–∞–Ω–µ–ª—å –∑–∞–¥–∞–Ω–∏–π</h2>
          <p id="panelDesc">–ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –∑–∞–¥–∞–Ω–∏—è. –ñ–º–∏ ¬´–°–¢–ê–†–¢¬ª.</p>
        </div>

        <!-- TASK 1 -->
        <div class="task hidden" id="task1">
          <div class="task-title"> ¬∑</div>
          <p class="q">–ü–ª–∞—Ç–æ–Ω –ø–æ–¥–∞–ª —Å–∏–≥–Ω–∞–ª SOS: ¬´–Ø –∑–∞–ø—É—Ç–∞–ª—Å—è –≤ —á—ë–º-—Ç–æ <b>  (–≤)—Ä–æ–¥–µ</b> —Å–æ–∑–≤–µ–∑–¥–∏—è-—Å–µ—Ç–∫–∏¬ª. –ß—Ç–æ –æ–Ω –∏–º–µ–ª –≤ –≤–∏–¥—É?</p>
          <div class="options">
            <label class="opt"><input type="radio" name="t1" value="prep"> <span><b>–ø—Ä–µ–¥–ª–æ–≥</b> <i>–≤—Ä–æ–¥–µ</i> (‚âà ¬´–Ω–∞–ø–æ–¥–æ–±–∏–µ¬ª)</span></label>
            <label class="opt"><input type="radio" name="t1" value="noun"> <span><b>—Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ</b> ¬´—Ä–æ–¥¬ª + –ø—Ä–µ–¥–ª–æ–≥ <i>"–≤"</i> (–≤ —á—ë–º? ‚Äî –≤ —Ä–æ–¥–µ)</span></label>
          </div>
          <div class="row">
            <button id="t1Check">–ü–†–û–í–ï–†–ò–¢–¨</button>
            <button id="t1HintBtn">–ü–û–î–°–ö–ê–ó–ö–ê</button>
          </div>
          <div class="hint" id="t1Hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–µ–¥–ª–æ–≥, –∫ —Å–ª–æ–≤—É –ø–æ—Å–ª–µ –Ω–µ–≥–æ –∑–∞–¥–∞—ë–º –≤–æ–ø—Ä–æ—Å <b>–æ—Ç –ø—Ä–µ–¥–ª–æ–≥–∞</b>: ¬´–≤—Ä–æ–¥–µ (—á–µ–≥–æ?) —Å–æ–∑–≤–µ–∑–¥–∏—è¬ª. –ï—Å–ª–∏ ¬´–≤ —Ä–æ–¥–µ¬ª, –≤–æ–ø—Ä–æ—Å –∑–∞–¥–∞—ë—Ç—Å—è –∫ —Å–ª–æ–≤—É ¬´—Ä–æ–¥¬ª: ¬´–≤ (—á—ë–º?) —Ä–æ–¥–µ¬ª.</div>
          <div class="msg" id="t1Msg"></div>
        </div>

        <!-- TASK 2 (—Ä–µ–∑–µ—Ä–≤ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ 1) -->
        <div class="task hidden" id="task2">
          <div class="task-title"> ¬∑ –î–æ–ø. –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞</div>
          <p class="q">–í—ã–±–µ—Ä–∏ –≤—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –≥–¥–µ <b>–≤—Ä–æ–¥–µ</b> ‚Äî —ç—Ç–æ <b>–ø—Ä–µ–¥–ª–æ–≥</b> (‚âà ¬´–Ω–∞–ø–æ–¥–æ–±–∏–µ¬ª, ¬´—Ç–∏–ø–∞¬ª ).</p>
          <div class="options" id="t2Options">
            <label class="opt"><input type="checkbox" value="1"> <span>–û–Ω –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –±—ã–ª –∫–µ–º-—Ç–æ <b>(–≤)—Ä–æ–¥–µ</b> –≥–µ—Ä–æ—è –∫–æ–º–∏–∫—Å–∞.</span></label>
            <label class="opt"><input type="checkbox" value="2"> <span>–≠—Ç–∏ –æ—Å–æ–±–∏ <b>(–≤)—Ä–æ–¥–µ</b> —Å–≤–æ—ë–º —É–Ω–∏–∫–∞–ª—å–Ω—ã.</span></label>
            <label class="opt"><input type="checkbox" value="3"> <span>–ü–æ—è–≤–∏–ª–æ—Å—å –Ω–µ—á—Ç–æ <b>(–≤)—Ä–æ–¥–µ</b> –∫–∞—Ä—Ç—ã —Å–æ–∑–≤–µ–∑–¥–∏–π.</span></label>
            <label class="opt"><input type="checkbox" value="4"> <span>(–í)—Ä–æ–¥–µ –º–µ–∂–≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–±—É–∏–Ω–æ–≤<b>–≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è</b>–≥–∏–≥–∞–Ω—Ç—ã.</span></label>
          </div>
          <div class="row">
            <button id="t2Check">–ü–†–û–í–ï–†–ò–¢–¨</button>
          </div>
          <div class="msg" id="t2Msg"></div>
          <div class="mini"><span class="answer-hint">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:</span> </div>
        </div>

        <!-- TASK 3 -->
        <div class="task hidden" id="task3">
          <div class="task-title"> ¬∑</div>
          <p class="q">–ö–∞–∫  –≤–æ—Å–ø—Ä–∏–Ω—è–ª  —Å–ª–æ–≤–æ (–í)–†–û–î–ï <b>—Ä–æ–±–æ—Ç-–¥–∏—Å–ø–µ—Ç—á–µ—Ä</b>?</p>
          <div class="options">
            <label class="opt"><input type="radio" name="t3" value="a"> <span>–ö–∞–∫ –ø—Ä–µ–¥–ª–æ–≥ <b>–≤—Ä–æ–¥–µ.</span></label>
            <label class="opt"><input type="radio" name="t3" value="b"> <span>–ö–∞–∫ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ —Å –ø—Ä–µ–¥–ª–æ–≥–æ–º.</span></label>
          </div>
          <div class="row">
            <button id="t3Check">–ü–†–û–í–ï–†–ò–¢–¨</button>
            <button id="t3HintBtn">–ü–û–î–°–ö–ê–ó–ö–ê</button>
          </div>
          <div class="hint" id="t3Hint">–ï—Å–ª–∏ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ ¬´—Ç–∏–ø–∞ / –Ω–∞–ø–æ–¥–æ–±–∏–µ¬ª, —Ç–æ —ç—Ç–æ –ø—Ä–µ–¥–ª–æ–≥.</div>
          <div class="msg" id="t3Msg"></div>
        </div>

        <!-- TASK 5 (–æ—Å–Ω–æ–≤–Ω–æ–µ –ø–æ—Å–ª–µ video2) -->
        <div class="task hidden" id="task5">
          <div class="task-title"> ¬∑ ¬´–î–∏—Å–ø–µ—Ç—á–µ—Ä-—á–∞–π–Ω–∏–∫¬ª</div>
          <p class="q">
            –ü–ª–∞—Ç–æ–Ω –æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –ø–ª–æ—Ö–æ –∑–Ω–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫:
            <br><br>
            <b>"–ü–æ–∫–æ–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤-–Ω–µ—É—á–µ–π! (–í)—Ä–æ–¥–µ</b>
            <select class="inline-select" id="t5Sel1">
              <option value="">‚Äî –≤—ã–±–µ—Ä–∏ ‚Äî</option>
              <option value="prep">–ø—Ä–µ–¥–ª–æ–≥, —Å–ª–∏—Ç–Ω–æ</option>
              <option value="noun">—Å—É—â. —Å –ø—Ä–µ–¥–ª–æ–≥–æ–º, —Ä–∞–∑–¥–µ–ª—å–Ω–æ</option>
            </select>
            <b>–∫–æ—Ç–æ—Ä—ã—Ö</b> –æ–¥–Ω–∏ —á–∞–π–Ω–∏–∫–∏
            <b>(–≤)—Ä–æ–¥–µ</b>
            <select class="inline-select" id="t5Sel2">
              <option value="">‚Äî –≤—ã–±–µ—Ä–∏ ‚Äî</option>
              <option value="prep">–ø—Ä–µ–¥–ª–æ–≥, —Å–ª–∏—Ç–Ω–æ</option>
              <option value="noun">—Å—É—â. —Å –ø—Ä–µ–¥–ª–æ–≥–æ–º, —Ä–∞–∑–¥–µ–ª—å–Ω–æ</option>
            </select>
            <b>—ç—Ç–æ–≥–æ"</b>.
          </p>
          <div class="row">
            <button id="t5Check">–ü–†–û–í–ï–†–ò–¢–¨</button>
          </div>
          <div class="msg" id="t5Msg"></div>
        </div>

        <!-- TASK 4 (—Ä–µ–∑–µ—Ä–≤ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ 5) -->
        <div class="task hidden" id="task4">
          <div class="task-title"> ¬∑ –î–æ–ø. –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ (–µ—Å–ª–∏ –≤ 5 –æ—à–∏–±—Å—è)</div>
          <p class="q"><b>–û—Ç–º–µ—Ç—å —Ç–æ–ª—å–∫–æ</b> —Ç–µ –ø—Ä–∏–º–µ—Ä—ã, –≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ <b>–≤ —Ä–æ–¥–µ</b> (—Å—É—â.+–ø—Ä.).</p>
          <div class="options" id="t4Options">
            <label class="opt"><input type="checkbox" value="prep1"> <span>–≠—Ç–æ –±—ã–ª–æ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ <b>(–≤)—Ä–æ–¥–µ</b> –ª–æ–≤—É—à–∫–∏.</span></label>
            <label class="opt"><input type="checkbox" value="noun1"> <span>–ü–ª–∞—Ç–æ–Ω  —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è <b>(–≤)—Ä–æ–¥–µ</b> –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä.</span></label>
            <label class="opt"><input type="checkbox" value="prep2"> <span>–ù–µ—É—á–µ–π <b>(–≤)—Ä–æ–¥–µ –≤–∞—Å –Ω–µ–ª—å–∑—è</b> –¥–æ–ø—É—Å–∫–∞—Ç—å –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–æ–ª–µ—Ç–æ–º.</span></label>
            <label class="opt"><input type="checkbox" value="noun2"> <span>(–≤)—Ä–æ–¥–µ, —á–∏—Å–ª–µ, –ø–∞–¥–µ–∂–µ) <b>–∏–∑–º–µ–Ω—è—é—Ç—Å—è</b> –Ω–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ, –∞ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ.</span></label>
          </div>
          <div class="row">
            <button id="t4Check">–ü–†–û–í–ï–†–ò–¢–¨</button>
          </div>
          <div class="msg" id="t4Msg"></div>
          <div class="mini"><span class="answer-hint">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:</span> noun1 –∏ noun2.</div>
        </div>


        <!-- TASK 6 (—Ä–µ–∑–µ—Ä–≤ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ 5) -->
        <div class="task hidden" id="task6">
          <div class="task-title"> ¬∑ –î–æ–ø. –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞ (–µ—Å–ª–∏ –≤ 5 –æ—à–∏–±—Å—è)</div>
          <p class="q">
            –ü–ª–∞—Ç–æ–Ω ‚Äî —Å–∞–º—ã–π –≥—Ä–∞–º–æ—Ç–Ω—ã–π <span class="token" data-correct="0">(–≤)—Ä–æ–¥–µ</span> –ø–æ–ø—É–≥–∞–µ–≤-–∫–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤ ‚Äî –ø–æ–∫–∞–∑–∞–ª –Ω–∞–º, –∫–∞–∫ –≤–∞–∂–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ
            <span class="token" data-correct="0">(–≤)—Ä–æ–¥–µ</span>, —á–∏—Å–ª–µ –∏ –ø–∞–¥–µ–∂–µ –≥–ª–∞–≤–Ω—ã—Ö —Å–ª–æ–≤, –Ω–æ –∏ –≤ –ø—Ä–∞–≤–æ–ø–∏—Å–∞–Ω–∏–∏ —Å–ª—É–∂–µ–±–Ω—ã—Ö
            <span class="token" data-correct="1">(–≤)—Ä–æ–¥–µ</span> –ø—Ä–µ–¥–ª–æ–≥–æ–≤.
            –≠—Ç–æ –±—ã–ª –Ω–∞–≥–ª—è–¥–Ω—ã–π —É—Ä–æ–∫ –∏–ª–∏ —á—Ç–æ-—Ç–æ
            <span class="token" data-correct="1">(–≤)—Ä–æ–¥–µ</span> —Ç–æ–≥–æ.
          </p>
          <div class="row">
            <button id="t6Check">–ü–†–û–í–ï–†–ò–¢–¨</button>
          </div>
          <div class="msg" id="t6Msg"></div>
        </div>

        <div class="footer-note" id="footerNote"></div>
      </aside>
    </main>
  </div>

  
  <script>
    const INTRO = 'video.mp4';
    const AFTER_T1 = 'video1.mp4';
    const VIDEO2 = 'video2.mp4';
    const VIDEO4 = 'temp4.mp4';

    const RULE1_IMG = 'rule.png';
    const RULE2_IMG = 'rule2.png';
    const RULE3_IMG = 'rule3.png';

    const FINAL = 'video3.mp4';

    const ST = {
      IDLE: 'IDLE',
      INTRO_VIDEO: 'INTRO_VIDEO',

      TASK1: 'TASK1',
      RULE1: 'RULE1',
      TASK2: 'TASK2',
      VIDEO4: 'VIDEO4',   // –ø–æ—Å–ª–µ –∑–∞–¥–∞–Ω–∏—è 2, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –∑–∞–¥–∞–Ω–∏–µ 1
      VIDEO1: 'VIDEO1',

      TASK3: 'TASK3',
      RULE2: 'RULE2',
      TASK4: 'TASK4',

      VIDEO2: 'VIDEO2',
      TASK5: 'TASK5',

      RULE3: 'RULE3',
      TASK6: 'TASK6',

      FINAL: 'FINAL'
    };

    let state = ST.IDLE;
    let t6HadError = false;

    const btnStart = document.getElementById('btnStart');
    const btnContinue = document.getElementById('btnContinue');
    const statusBadge = document.getElementById('statusBadge');

    const player = document.getElementById('player');
    const picture = document.getElementById('picture');
    const welcome = document.getElementById('welcome');

    const panelTitle = document.getElementById('panelTitle');
    const panelDesc = document.getElementById('panelDesc');

    const task1 = document.getElementById('task1');
    const task2 = document.getElementById('task2');
    const task3 = document.getElementById('task3');
    const task4 = document.getElementById('task4');
    const task5 = document.getElementById('task5');
    const task6 = document.getElementById('task6');

    const t1Check = document.getElementById('t1Check');
    const t1HintBtn = document.getElementById('t1HintBtn');
    const t1Hint = document.getElementById('t1Hint');
    const t1Msg = document.getElementById('t1Msg');

    const t2Check = document.getElementById('t2Check');
    const t2Msg = document.getElementById('t2Msg');

    const t3Check = document.getElementById('t3Check');
    const t3HintBtn = document.getElementById('t3HintBtn');
    const t3Hint = document.getElementById('t3Hint');
    const t3Msg = document.getElementById('t3Msg');

    const t4Check = document.getElementById('t4Check');
    const t4Msg = document.getElementById('t4Msg');

    const t5Sel1 = document.getElementById('t5Sel1');
    const t5Sel2 = document.getElementById('t5Sel2');
    const t5Check = document.getElementById('t5Check');
    const t5Msg = document.getElementById('t5Msg');

    const t6Check = document.getElementById('t6Check');
    const t6Msg = document.getElementById('t6Msg');
    const t6Tokens = [...document.querySelectorAll('#task6 .token')];

    function setBadge(text){ statusBadge.textContent = text; }

    function enableContinuePulse(on){
      if(on){
        btnContinue.disabled = false;
        btnContinue.classList.add('pulse');
      } else {
        btnContinue.disabled = true;
        btnContinue.classList.remove('pulse');
      }
    }

    function showOnlyTask(el){
      [task1, task2, task3, task4, task5, task6].forEach(t => t.classList.add('hidden'));
      if(el) el.classList.remove('hidden');
    }

    function clearMsgs(){
      [t1Msg,t2Msg,t3Msg,t4Msg,t5Msg,t6Msg].forEach(m => { m.className = 'msg'; m.textContent=''; });
    }

    function hideMedia(){
      player.pause();
      player.classList.add('hidden');
      picture.classList.add('hidden');
      welcome.classList.add('hidden');
    }

    function showWelcome(){
      hideMedia();
      welcome.classList.remove('hidden');
    }

    async function playVideo(filename){
      hideMedia();
      player.classList.remove('hidden');
      player.src = filename;
      player.load();
      try{ await player.play(); } catch(e){ console.warn('Autoplay blocked:', e); }
    }

    function showImage(filename, alt='–ö–∞—Ä—Ç–∏–Ω–∫–∞'){
      hideMedia();
      picture.classList.remove('hidden');
      picture.alt = alt;
      picture.src = filename;
    }

    function showFinalVideo(filename){
      hideMedia();
      player.classList.remove('hidden');
      player.src = filename;
      player.load();
      player.muted = true;
      player.playsInline = true;
      const p = player.play();
      if(p && typeof p.catch === 'function') p.catch(()=>{});
    }

    function resetToIdle(){
      state = ST.IDLE;
      btnStart.disabled = false;
      enableContinuePulse(false);
      setBadge('–ì–æ—Ç–æ–≤–æ –∫ —Å—Ç–∞—Ä—Ç—É');
      panelTitle.textContent = '–ü–∞–Ω–µ–ª—å –∑–∞–¥–∞–Ω–∏–π';
      panelDesc.textContent = '–ù–∞–∂–º–∏ ¬´–°–¢–ê–†–¢¬ª. –ü–æ—Å–ª–µ –≤–∏–¥–µ–æ –ø–æ—è–≤–∏—Ç—Å—è –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ.';
      showOnlyTask(null);
      clearMsgs();
      t1Hint.style.display = 'none';
      t3Hint.style.display = 'none';

      document.querySelectorAll('input[name="t1"]').forEach(i=> i.checked=false);
      document.querySelectorAll('#t2Options input[type="checkbox"]').forEach(i=> i.checked=false);
      document.querySelectorAll('input[name="t3"]').forEach(i=> i.checked=false);
      document.querySelectorAll('#t4Options input[type="checkbox"]').forEach(i=> i.checked=false);
      t5Sel1.value = '';
      t5Sel2.value = '';

      // task6 tokens
      t6Tokens.forEach(t=>{
        t.classList.remove('selected','good','bad');
        t.dataset.selected = '0';
      });


      t6HadError = false;

      showWelcome();
    }

    function resetTask6UI(){
      // –°–±—Ä–æ—Å –∫–ª–∏–∫–æ–≤ –∏ –ø–æ–¥—Å–≤–µ—Ç–æ–∫ –∑–∞–¥–∞–Ω–∏—è 6 (—á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
      t6Msg.className = 'msg';
      t6Msg.textContent = '';
      t6Tokens.forEach(t=>{
        t.dataset.selected = '0';
        t.classList.remove('selected','good','bad');
      });
    }

    function go(next){
      clearMsgs();
      t1Hint.style.display = 'none';
      t3Hint.style.display = 'none';

      state = next;
      btnStart.disabled = true;
      enableContinuePulse(false);

      switch(next){
        case ST.IDLE:
          resetToIdle();
          break;

        case ST.INTRO_VIDEO:
          setBadge('–í–∏–¥–µ–æ: —Å—Ç–∞—Ä—Ç');
          panelTitle.textContent = '–°–º–æ—Ç—Ä–∏ –≤–∏–¥–µ–æ';
          panelDesc.textContent = '–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ.';
          showOnlyTask(null);
          playVideo(INTRO);
          break;

        case ST.TASK1:
          setBadge('');
          panelTitle.textContent = '';
          panelDesc.textContent = '–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –∏ –Ω–∞–∂–º–∏ ¬´–ü–†–û–í–ï–†–ò–¢–¨¬ª.';
          showOnlyTask(task1);
          showWelcome();
          break;

        case ST.RULE1:
          setBadge('–ü—Ä–∞–≤–∏–ª–æ');
          panelTitle.textContent = '–û—à–∏–±–∫–∞ ‚Äî —Å–º–æ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ';
          panelDesc.textContent = '–ü–æ—Ç–æ–º –Ω–∞–∂–º–∏ ¬´–ü–†–û–î–û–õ–ñ–ò–¢–¨¬ª ‚Äî –±—É–¥–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ.';
          showOnlyTask(null);
          showImage(RULE1_IMG, '–ü—Ä–∞–≤–∏–ª–æ');
          enableContinuePulse(true);
          break;

        case ST.TASK2:
          setBadge('');
          panelTitle.textContent = '';
          panelDesc.textContent = '–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ –∑–∞–¥–∞–Ω–∏–∏ 1.';
          showOnlyTask(task2);
          showWelcome();
          break;

        case ST.VIDEO4:
          setBadge('–í–∏–¥–µ–æ: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –º–∏—Å—Å–∏–∏');
          panelTitle.textContent = '–°—é–∂–µ—Ç';
          panelDesc.textContent = '–ü–æ—Å–ª–µ –≤–∏–¥–µ–æ —Å–Ω–æ–≤–∞ –±—É–¥–µ—Ç –∑–∞–¥–∞–Ω–∏–µ 1.';
          showOnlyTask(null);
          playVideo(VIDEO4);
          break;

        case ST.VIDEO1:
          setBadge('–í–∏–¥–µ–æ: –ø–æ—Å–ª–µ –∑–∞–¥–∞–Ω–∏—è 1');
          panelTitle.textContent = '–°—é–∂–µ—Ç';
          panelDesc.textContent = '–°–º–æ—Ç—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ.';
          showOnlyTask(null);
          playVideo(AFTER_T1);
          break;

        case ST.TASK3:
          setBadge('');
          panelTitle.textContent = '';
          panelDesc.textContent = '–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –∏ –Ω–∞–∂–º–∏ ¬´–ü–†–û–í–ï–†–ò–¢–¨¬ª.';
          showOnlyTask(task3);
          showWelcome();
          break;

        case ST.RULE2:
          setBadge('–ü—Ä–∞–≤–∏–ª–æ');
          panelTitle.textContent = '–û—à–∏–±–∫–∞ ‚Äî —Å–º–æ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ';
          panelDesc.textContent = '–ü–æ—Ç–æ–º –Ω–∞–∂–º–∏ ¬´–ü–†–û–î–û–õ–ñ–ò–¢–¨¬ª ‚Äî –±—É–¥–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ.';
          showOnlyTask(null);
          showImage(RULE2_IMG, '–ü—Ä–∞–≤–∏–ª–æ');
          enableContinuePulse(true);
          break;

        case ST.TASK4:
          setBadge('');
          panelTitle.textContent = '';
          panelDesc.textContent = '–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ –∑–∞–¥–∞–Ω–∏–∏ 3.';
          showOnlyTask(task4);
          showWelcome();
          break;

        case ST.VIDEO2:
          setBadge('–í–∏–¥–µ–æ: –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ');
          panelTitle.textContent = '–°—é–∂–µ—Ç';
          panelDesc.textContent = '–ü–æ—Å–ª–µ –≤–∏–¥–µ–æ –ø–æ—è–≤–∏—Ç—Å—è —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ.';
          showOnlyTask(null);
          playVideo(VIDEO2);
          break;

        case ST.TASK5:
          setBadge('');
          panelTitle.textContent = '';
          panelDesc.textContent = '–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö –∏ –Ω–∞–∂–º–∏ ¬´–ü–†–û–í–ï–†–ò–¢–¨¬ª.';
          showOnlyTask(task5);
          showWelcome();
          break;

        case ST.RULE3:
          setBadge('–ü—Ä–∞–≤–∏–ª–æ');
          panelTitle.textContent = '–û—à–∏–±–∫–∞ ‚Äî —Å–º–æ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ';
          panelDesc.textContent = '–ü–æ—Ç–æ–º –Ω–∞–∂–º–∏ ¬´–ü–†–û–î–û–õ–ñ–ò–¢–¨¬ª ‚Äî –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ.';
          showOnlyTask(null);
          showImage(RULE3_IMG, '–ü—Ä–∞–≤–∏–ª–æ');
          enableContinuePulse(true);
          break;

        case ST.TASK6:
          setBadge('');
          panelTitle.textContent = '';
          panelDesc.textContent = '–ö–ª–∏–∫–Ω–∏ –ø–æ —Å–ª–æ–≤–∞–º, –≥–¥–µ ¬´–≤—Ä–æ–¥–µ¬ª ‚Äî –ø—Ä–µ–¥–ª–æ–≥. –ó–∞—Ç–µ–º –Ω–∞–∂–º–∏ ¬´–ü–†–û–í–ï–†–ò–¢–¨¬ª.';
          resetTask6UI();
          showOnlyTask(task6);
          showWelcome();
          break;

        case ST.FINAL:
          setBadge('–§–∏–Ω–∞–ª');
          panelTitle.textContent = '–°–≤—è–∑—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';
          panelDesc.textContent = '–ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –ú–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.';
          showOnlyTask(null);
          showFinalVideo(FINAL);
          btnStart.disabled = false;
          break;
      }
    }

    // –í–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    btnStart.addEventListener('click', () => {
      go(ST.INTRO_VIDEO);
    });

    btnContinue.addEventListener('click', () => {
      if(state === ST.RULE1) go(ST.TASK2);
      else if(state === ST.RULE2) go(ST.TASK4);
      else if(state === ST.RULE3) go(ST.TASK6);
    });

    // –í–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
    player.addEventListener('ended', () => {
      if(state === ST.INTRO_VIDEO) go(ST.TASK1);
      else if(state === ST.VIDEO1) go(ST.TASK3);
      else if(state === ST.VIDEO4) go(ST.TASK1);
      else if(state === ST.VIDEO2) go(ST.TASK5);
    });

    // TASK 1
    t1HintBtn.addEventListener('click', () => {
      t1Hint.style.display = (t1Hint.style.display === 'none' || !t1Hint.style.display) ? 'block' : 'none';
    });

    t1Check.addEventListener('click', () => {
      const sel = document.querySelector('input[name="t1"]:checked');
      if(!sel){
        t1Msg.className = 'msg bad';
        t1Msg.textContent = '–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ üôÇ';
        return;
      }

      if(sel.value === 'prep'){
        t1Msg.className = 'msg good';
        t1Msg.textContent = '–í–µ—Ä–Ω–æ! ¬´–≤—Ä–æ–¥–µ¬ª –∑–¥–µ—Å—å ‚Äî –ø—Ä–µ–¥–ª–æ–≥.';
        setTimeout(() => go(ST.VIDEO1), 450);
      } else {
        t1Msg.className = 'msg bad';
        t1Msg.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç. –°–º–æ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ.';
        setTimeout(() => go(ST.RULE1), 450);
      }
    });

    // TASK 2 (—Ä–µ–∑–µ—Ä–≤ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ 1)
    t2Check.addEventListener('click', () => {
      const checked = [...document.querySelectorAll('#t2Options input[type="checkbox"]')]
        .filter(i => i.checked)
        .map(i => i.value);

      const correct = ['1','3'];
      const ok = checked.length === correct.length && checked.every(v => correct.includes(v));

      if(ok){
        t2Msg.className = 'msg good';
        t2Msg.textContent = '–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å—é–∂–µ—Ç üôÇ';
        setTimeout(() => go(ST.VIDEO4), 550);
      } else {
        t2Msg.className = 'msg bad';
        t2Msg.textContent = '–ù–µ —Å–æ–≤—Å–µ–º. –ì–¥–µ ¬´–≤—Ä–æ–¥–µ¬ª –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ ¬´–ø–æ–¥–æ–±–Ω–æ / —Ç–∏–ø–∞¬ª?';
      }
    });

    // TASK 3
    t3HintBtn.addEventListener('click', () => {
      t3Hint.style.display = (t3Hint.style.display === 'none' || !t3Hint.style.display) ? 'block' : 'none';
    });

    t3Check.addEventListener('click', () => {
      const sel = document.querySelector('input[name="t3"]:checked');
      if(!sel){
        t3Msg.className = 'msg bad';
        t3Msg.textContent = '–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ üôÇ';
        return;
      }

      // –ü–æ —Å—é–∂–µ—Ç—É –¥–∏—Å–ø–µ—Ç—á–µ—Ä –ø–æ–Ω—è–ª –∫–∞–∫ "–≤ —Ä–æ–¥–µ" (—Å—É—â. + –ø—Ä–µ–¥–ª–æ–≥)
      if(sel.value === 'b'){
        t3Msg.className = 'msg good';
        t3Msg.textContent = '–í–µ—Ä–Ω–æ! –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–æ—Å–ø—Ä–∏–Ω—è–ª —ç—Ç–æ –∫–∞–∫ ¬´–≤ —Ä–æ–¥–µ¬ª (–≤ —á—ë–º?) ‚Äî —Å—É—â.+–ø—Ä–µ–¥–ª–æ–≥.';
        setTimeout(() => go(ST.VIDEO2), 550);
      } else {
        t3Msg.className = 'msg bad';
        t3Msg.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç. –°–º–æ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ.';
        setTimeout(() => go(ST.RULE2), 450);
      }
    });

    // TASK 4 (—Ä–µ–∑–µ—Ä–≤ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –≤ 3): –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å noun1 –∏ noun2, –ø–æ—Ç–æ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å—é–∂–µ—Ç (video2)
    t4Check.addEventListener('click', () => {
      const checks = [...document.querySelectorAll('#t4Options input[type="checkbox"]')];
      const picked = checks.filter(i => i.checked).map(i => i.value);

      const correct = ['noun1','noun2'];
      const ok = picked.length === correct.length && picked.every(v => correct.includes(v));

      if(ok){
        t4Msg.className = 'msg good';
        t4Msg.textContent = '–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å—é–∂–µ—Ç üôÇ';
        setTimeout(() => go(ST.VIDEO2), 550);
      } else {
        t4Msg.className = 'msg bad';
        t4Msg.textContent = '–ü–æ—á—Ç–∏! –û—Ç–º–µ—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ ¬´–≤ —Ä–æ–¥–µ¬ª (—Å—É—â.+–ø—Ä.).';
      }
    });

    // TASK 5 (–æ—Å–Ω–æ–≤–Ω–æ–µ): 1-–µ noun, 2-–µ prep
    t5Check.addEventListener('click', () => {
      const a = t5Sel1.value;
      const b = t5Sel2.value;

      if(!a || !b){
        t5Msg.className = 'msg bad';
        t5Msg.textContent = '–ó–∞–ø–æ–ª–Ω–∏ –æ–±–∞ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞ üôÇ';
        return;
      }

      const ok = (a === 'noun') && (b === 'prep');

      if(ok){
        t5Msg.className = 'msg good';
        t5Msg.textContent = '–°—É–ø–µ—Ä! –î–∏—Å–ø–µ—Ç—á–µ—Ä –ø–æ–Ω—è–ª –ü–ª–∞—Ç–æ–Ω–∞ üòÑ –§–∏–Ω–∞–ª!';
        setTimeout(() => go(ST.FINAL), 650);
      } else {
        t5Msg.className = 'msg bad';
        t5Msg.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç. –°–º–æ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ ‚Äî –∏ –±—É–¥–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ.';
        setTimeout(() => go(ST.RULE3), 500);
      }
    });

    // TASK 6 tokens: –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ü–†–û–í–ï–†–ò–¢–¨
    t6Tokens.forEach(tok=>{
      tok.addEventListener('click', ()=>{
        const selected = tok.dataset.selected === '1';

        // –ü—Ä–∏ –ª—é–±–æ–º –∫–ª–∏–∫–µ —Å–Ω–∏–º–∞–µ–º –ø—Ä–æ—à–ª—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É (–µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –±—ã–ª–∞)
        tok.classList.remove('good','bad');

        if(selected){
          tok.dataset.selected = '0';
          tok.classList.remove('selected');
          return;
        }

        tok.dataset.selected = '1';
        tok.classList.add('selected');
      });
    });

    t6Check.addEventListener('click', ()=>{
      // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
      t6Tokens.forEach(t=> t.classList.remove('good','bad'));

      const selectedTokens = t6Tokens.filter(t=> t.dataset.selected === '1');
      const pickedCorrect = selectedTokens.filter(t=> t.dataset.correct === '1').length;
      const pickedWrong = selectedTokens.filter(t=> t.dataset.correct === '0').length;
      const totalCorrect = t6Tokens.filter(t=> t.dataset.correct === '1').length;

      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤
      selectedTokens.forEach(t=>{
        if(t.dataset.correct === '1') t.classList.add('good');
        else t.classList.add('bad');
      });

      const ok = (pickedCorrect === totalCorrect) && (pickedWrong === 0);

      if(ok){
        t6Msg.className = 'msg good';
        t6Msg.textContent = '–í–µ—Ä–Ω–æ!';
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≤–∏–¥–µ–æ2 -> –∑–∞–¥–∞–Ω–∏–µ 5 -> —Ñ–∏–Ω–∞–ª (—Ç–∞–∫ –∫–∞–∫ —É—á–µ–Ω–∏–∫ —Ä–∞–Ω–µ–µ –æ—à–∏–±—Å—è –≤ –∑–∞–¥–∞–Ω–∏–∏ 5)
        setTimeout(()=>go(ST.VIDEO2), 650);
      } else {
        t6HadError = true;
        t6Msg.className = 'msg bad';
        t6Msg.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç. –°–º–æ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–æ –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.';
        setTimeout(()=>go(ST.RULE3), 550);
      }
    });

    // ===== DEV MODE (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏) =====
    (function(){
      try{
        const qs = new URLSearchParams(location.search);
        if(qs.get('dev') === '1') document.body.classList.add('dev');
      }catch(e){}
      window.addEventListener('keydown', (e)=>{
        if((e.ctrlKey || e.metaKey) && (e.key === 'i' || e.key === 'I')){
          e.preventDefault();
          document.body.classList.toggle('dev');
        }
      });
    })();

    // –°—Ç–∞—Ä—Ç
    resetToIdle();
  </script>
</body>
</html>
